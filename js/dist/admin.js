(()=>{var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var r in t)e.o(t,r)&&!e.o(a,r)&&Object.defineProperty(a,r,{enumerable:!0,get:t[r]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};(()=>{"use strict";const a=flarum.core.compat["admin/app"];var t=e.n(a);function r(e,a){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,a){return e.__proto__=a,e},r(e,a)}function s(e,a){e.prototype=Object.create(a.prototype),e.prototype.constructor=e,r(e,a)}const i=flarum.core.compat["admin/components/ExtensionPage"];var n=e.n(i);const l=flarum.core.compat["common/components/LoadingIndicator"];var o=e.n(l);const d=flarum.core.compat["common/Component"];var c=e.n(d),u=function(e){function a(){return e.apply(this,arguments)||this}s(a,e);var t=a.prototype;return t.view=function(){var e=this.attrs.stats||{total:0,positive:0,neutral:0,negative:0};return m("div",{className:"TraderFeedbackStats"},this.card({icon:"fas fa-exchange-alt",value:e.total,label:"Total Feedbacks",type:"total"}),this.card({icon:"fas fa-thumbs-up",value:e.positive,label:"Positive",percentage:e.total>0?Math.round(e.positive/e.total*100):0,type:"positive"}),this.card({icon:"fas fa-minus-circle",value:e.neutral,label:"Neutral",percentage:e.total>0?Math.round(e.neutral/e.total*100):0,type:"neutral"}),this.card({icon:"fas fa-thumbs-down",value:e.negative,label:"Negative",percentage:e.total>0?Math.round(e.negative/e.total*100):0,type:"negative"}))},t.card=function(e){return m("div",{className:"StatsCard StatsCard--"+e.type},m("div",{className:"StatsCard-icon"},m("i",{className:e.icon})),m("div",{className:"StatsCard-content"},m("div",{className:"StatsCard-value"},e.value),m("div",{className:"StatsCard-label"},e.label),void 0!==e.percentage&&m("div",{className:"StatsCard-percentage"},e.percentage,"%")))},a}(c());const p=flarum.core.compat["common/components/Button"];var f=e.n(p);const b=flarum.core.compat["common/helpers/avatar"];var h=e.n(b);const v=flarum.core.compat["common/helpers/humanTime"];var g=e.n(v),y=function(e){function a(){return e.apply(this,arguments)||this}return s(a,e),a.prototype.view=function(){var e,a,r,s,i=this.attrs,n=i.feedback,l=i.included,o=i.onApprove,d=i.onReject,c=(null==(e=n.relationships)||null==(e=e.fromUser)||null==(e=e.data)?void 0:e.id)||(null==(a=n.relationships)||null==(a=a.from)||null==(a=a.data)?void 0:a.id),u=(null==(r=n.relationships)||null==(r=r.toUser)||null==(r=r.data)?void 0:r.id)||(null==(s=n.relationships)||null==(s=s.to)||null==(s=s.data)?void 0:s.id),p=c?t().store.getById("users",c):null,b=u?t().store.getById("users",u):null;if(!p&&c){var v=null==l?void 0:l.find((function(e){return"users"===e.type&&e.id===c}));v&&(p=t().store.pushPayload({data:v}))}if(!b&&u){var y=null==l?void 0:l.find((function(e){return"users"===e.type&&e.id===u}));y&&(b=t().store.pushPayload({data:y}))}var k="positive"===n.attributes.type?"Badge--success":"negative"===n.attributes.type?"Badge--danger":"Badge--warning",N="positive"===n.attributes.type?"thumbs-up":"negative"===n.attributes.type?"thumbs-down":"minus",_="buyer"===n.attributes.role?"shopping-cart":"seller"===n.attributes.role?"store":"exchange-alt";return m("div",{className:"FeedbackCard FeedbackCard--"+n.attributes.type},m("div",{className:"FeedbackCard-header"},m("div",{className:"FeedbackCard-users"},m("div",{className:"FeedbackCard-user"},p&&h()(p),m("strong",null,p?p.displayName():t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.user_id_format",{id:c}))),m("i",{className:"fas fa-arrow-right FeedbackCard-arrow"}),m("div",{className:"FeedbackCard-user"},b&&h()(b),m("strong",null,b?b.displayName():t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.user_id_format",{id:u})))),m("div",{className:"FeedbackCard-meta"},m("span",{className:"Badge "+k},m("i",{className:"fas fa-"+N})),m("span",{className:"FeedbackCard-roleBadge"},m("i",{className:"fas fa-"+_}),m("span",null,t().translator.trans("huseyinfiliz-traderfeedback.admin.roles."+n.attributes.role))),(n.attributes.created_at||n.attributes.updated_at)&&m("span",{className:"FeedbackCard-dateBadge"},m("i",{className:"far fa-clock"}),m("span",null,g()(new Date(n.attributes.created_at||n.attributes.updated_at)))))),n.attributes.comment&&m("div",{className:"FeedbackCard-comment"},m("p",null,n.attributes.comment)),n.attributes.discussion_id&&m("a",{href:t().route("discussion",{id:n.attributes.discussion_id}),className:"FeedbackCard-discussion",target:"_blank"},m("i",{className:"fas fa-comments"}),t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.view_discussion")),m("div",{className:"FeedbackCard-actions"},m(f(),{className:"Button Button--primary",icon:"fas fa-check",onclick:function(){return o(n)}},t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.approve_button")),m(f(),{className:"Button",icon:"fas fa-times",onclick:function(){return d(n)}},t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.reject_button"))))},a}(c()),k=function(e){function a(){return e.apply(this,arguments)||this}return s(a,e),a.prototype.view=function(){var e,a,r,s,i,n,l,o=this.attrs,d=o.report,c=o.included,u=o.onDismiss,p=o.onDelete,b=(null==(e=d.relationships)||null==(e=e.reporter)||null==(e=e.data)?void 0:e.id)||(null==(a=d.relationships)||null==(a=a.user)||null==(a=a.data)?void 0:a.id),v=b?t().store.getById("users",b):null;if(!v&&b){var y=null==c?void 0:c.find((function(e){return"users"===e.type&&e.id===b}));y&&(v=t().store.pushPayload({data:y}))}var k=null==(r=d.relationships)||null==(r=r.feedback)||null==(r=r.data)?void 0:r.id,N=null==c?void 0:c.find((function(e){return"trader-feedbacks"===e.type&&e.id===k})),_=(null==N||null==(s=N.relationships)||null==(s=s.fromUser)||null==(s=s.data)?void 0:s.id)||(null==N||null==(i=N.relationships)||null==(i=i.from)||null==(i=i.data)?void 0:i.id),z=(null==N||null==(n=N.relationships)||null==(n=n.toUser)||null==(n=n.data)?void 0:n.id)||(null==N||null==(l=N.relationships)||null==(l=l.to)||null==(l=l.data)?void 0:l.id),F=_?t().store.getById("users",_):null,w=z?t().store.getById("users",z):null;if(!F&&_){var C=null==c?void 0:c.find((function(e){return"users"===e.type&&e.id===_}));C&&(F=t().store.pushPayload({data:C}))}if(!w&&z){var S=null==c?void 0:c.find((function(e){return"users"===e.type&&e.id===z}));S&&(w=t().store.pushPayload({data:S}))}var B="positive"===(null==N?void 0:N.attributes.type)?"Badge--success":"negative"===(null==N?void 0:N.attributes.type)?"Badge--danger":"Badge--warning",T="positive"===(null==N?void 0:N.attributes.type)?"thumbs-up":"negative"===(null==N?void 0:N.attributes.type)?"thumbs-down":"minus";return m("div",{className:"ReportCard"},m("div",{className:"ReportCard-header"},m("div",{className:"ReportCard-reporter"},v&&h()(v),m("strong",null,v?v.displayName():b?t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.user_id_format",{id:b}):t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.unknown_user"))),(d.attributes.created_at||d.attributes.updated_at)&&m("span",{className:"ReportCard-dateBadge"},m("i",{className:"far fa-clock"}),m("span",null,g()(new Date(d.attributes.created_at||d.attributes.updated_at))))),d.attributes.reason&&m("div",{className:"ReportCard-reason"},m("strong",null,t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.reason_label")),m("p",null,d.attributes.reason)),N&&m("div",{className:"ReportCard-feedback"},m("div",{className:"ReportCard-feedbackHeader"},m("div",{className:"ReportCard-feedbackHeader-left"},m("span",null,t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.reported_feedback_label")),m("span",{className:"Badge "+B},m("i",{className:"fas fa-"+T})))),m("div",{className:"ReportCard-feedbackUsers"},F&&h()(F),m("span",null,F?F.displayName():t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.user_id_format",{id:_})),m("i",{className:"fas fa-arrow-right"}),w&&h()(w),m("span",null,w?w.displayName():t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.user_id_format",{id:z}))),N.attributes.comment&&m("div",{className:"ReportCard-feedbackComment"},m("p",null,N.attributes.comment))),m("div",{className:"ReportCard-actions"},m(f(),{className:"Button Button--primary",icon:"fas fa-check",onclick:function(){return u(d)}},t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.dismiss_button")),m(f(),{className:"Button",icon:"fas fa-trash",onclick:function(){return p(d)}},t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.delete_button"))))},a}(c()),N=function(e){function a(){return e.apply(this,arguments)||this}return s(a,e),a.prototype.view=function(){var e=this.attrs,a=e.buildSettingComponent,r=e.submitButton;return m("div",{className:"TraderFeedbackSettings"},m("div",{className:"SettingsSection"},m("h3",null,m("i",{className:"fas fa-cog"}),t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.section_general")),m("div",{className:"SettingsSection-content"},m("div",{className:"Form-group"},a({type:"boolean",setting:"huseyinfiliz.traderfeedback.requireApproval",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.require_approval_label")})),m("div",{className:"Form-group"},a({type:"boolean",setting:"huseyinfiliz.traderfeedback.allowNegative",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.allow_negative_label")})),m("div",{className:"Form-group"},a({type:"boolean",setting:"huseyinfiliz.traderfeedback.showBadgeInPosts",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.show_badge_in_posts_label"),help:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.show_badge_in_posts_help")})))),m("div",{className:"SettingsSection"},m("h3",null,m("i",{className:"fas fa-comments"}),t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.section_discussion")),m("div",{className:"SettingsSection-content"},m("div",{className:"Form-group"},a({type:"boolean",setting:"huseyinfiliz.traderfeedback.requireDiscussion",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.require_discussion_label"),help:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.require_discussion_help")})),m("div",{className:"Form-group"},a({type:"boolean",setting:"huseyinfiliz.traderfeedback.onePerDiscussion",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.one_per_discussion_label"),help:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.one_per_discussion_help")})))),m("div",{className:"SettingsSection"},m("h3",null,m("i",{className:"fas fa-comment-dots"}),t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.section_comment")),m("div",{className:"SettingsSection-content"},m("div",{className:"Form-group"},a({type:"number",setting:"huseyinfiliz.traderfeedback.minLength",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.min_length_label"),placeholder:"10",min:1})),m("div",{className:"Form-group"},a({type:"number",setting:"huseyinfiliz.traderfeedback.maxLength",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.max_length_label"),placeholder:"1000",min:1})))),m("div",{className:"SettingsSection"},m("h3",null,m("i",{className:"fas fa-user-check"}),t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.section_requirements")),m("div",{className:"SettingsSection-content"},m("div",{className:"Form-group"},a({type:"number",setting:"huseyinfiliz.traderfeedback.minDays",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.min_days_label"),help:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.min_days_help"),placeholder:"0",min:0})),m("div",{className:"Form-group"},a({type:"number",setting:"huseyinfiliz.traderfeedback.minPosts",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.min_posts_label"),help:t().translator.trans("huseyinfiliz-traderfeedback.admin.settings.min_posts_help"),placeholder:"0",min:0})))),m("div",{className:"Form-group"},r()))},a}(c()),_=function(e){function a(){for(var a,t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return(a=e.call.apply(e,[this].concat(r))||this).activeTab="settings",a.loading=!1,a.reports=[],a.pendingFeedbacks=[],a.stats=null,a.included=[],a}s(a,e);var r=a.prototype;return r.oninit=function(a){e.prototype.oninit.call(this,a),this.loadStats()},r.content=function(){return m("div",{className:"TraderFeedbackPage"},m(u,{stats:this.stats}),this.tabs(),m("div",{className:"TraderFeedbackPage-content"},this.activeTabContent()))},r.tabs=function(){var e=this;return m("div",{className:"TraderFeedbackTabs"},m("button",{className:"TabButton"+("settings"===this.activeTab?" active":""),onclick:function(){e.activeTab="settings"}},m("i",{className:"fas fa-cog"}),m("span",null,t().translator.trans("huseyinfiliz-traderfeedback.admin.tabs.settings"))),m("button",{className:"TabButton"+("approvals"===this.activeTab?" active":""),onclick:function(){e.activeTab="approvals",0===e.pendingFeedbacks.length&&e.loadPendingFeedbacks()}},m("i",{className:"fas fa-check-circle"}),m("span",null,t().translator.trans("huseyinfiliz-traderfeedback.admin.tabs.approvals")),this.pendingFeedbacks.length>0&&m("span",{className:"TabButton-badge"},this.pendingFeedbacks.length)),m("button",{className:"TabButton"+("reports"===this.activeTab?" active":""),onclick:function(){e.activeTab="reports",0===e.reports.length&&e.loadReports()}},m("i",{className:"fas fa-flag"}),m("span",null,t().translator.trans("huseyinfiliz-traderfeedback.admin.tabs.reports")),this.reports.length>0&&m("span",{className:"TabButton-badge TabButton-badge--warning"},this.reports.length)))},r.activeTabContent=function(){switch(this.activeTab){case"settings":return m(N,{buildSettingComponent:this.buildSettingComponent.bind(this),submitButton:this.submitButton.bind(this)});case"approvals":return this.approvalsContent();case"reports":return this.reportsContent();default:return null}},r.approvalsContent=function(){var e=this;return this.loading?m(o(),null):0===this.pendingFeedbacks.length?m("div",{className:"EmptyState"},m("div",{className:"EmptyState-icon"},m("i",{className:"fas fa-check-circle"})),m("h3",null,t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.title")),m("p",null,t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.no_approvals"))):m("div",{className:"FeedbackList"},this.pendingFeedbacks.map((function(a){return m(y,{key:a.id,feedback:a,included:e.included,onApprove:function(a){return e.approveFeedback(a)},onReject:function(a){return e.rejectFeedback(a)}})})))},r.reportsContent=function(){var e=this;return this.loading?m(o(),null):0===this.reports.length?m("div",{className:"EmptyState"},m("div",{className:"EmptyState-icon"},m("i",{className:"fas fa-shield-alt"})),m("h3",null,t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.title")),m("p",null,t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.no_reports"))):m("div",{className:"ReportList"},this.reports.map((function(a){return m(k,{key:a.id,report:a,included:e.included,onDismiss:function(a){return e.dismissReport(a)},onDelete:function(a){return e.deleteReportedFeedback(a)}})})))},r.loadStats=function(){var e=this;t().request({method:"GET",url:t().forum.attribute("apiUrl")+"/trader/stats/summary"}).then((function(a){var t;t=a.data&&Array.isArray(a.data)&&a.data[0]?a.data[0].attributes:a.data&&a.data.attributes?a.data.attributes:a.attributes?a.attributes:void 0!==a.total?a:{total:0,positive:0,neutral:0,negative:0},e.stats={total:t.total||0,positive:t.positive||0,neutral:t.neutral||0,negative:t.negative||0},m.redraw()})).catch((function(a){e.stats={total:0,positive:0,neutral:0,negative:0},m.redraw()}))},r.loadPendingFeedbacks=function(){var e=this;this.loading=!0,this.included=[],m.redraw(),t().request({method:"GET",url:t().forum.attribute("apiUrl")+"/trader/feedback/pending"}).then((function(a){e.pendingFeedbacks=a.data||[],e.included=a.included||[],e.processIncluded(a),e.loading=!1,m.redraw()})).catch((function(a){e.loading=!1,m.redraw()}))},r.loadReports=function(){var e=this;this.loading=!0,this.included=[],m.redraw(),t().request({method:"GET",url:t().forum.attribute("apiUrl")+"/trader/reports"}).then((function(a){e.reports=a.data||[],e.included=a.included||[],e.processIncluded(a),e.loading=!1,m.redraw()})).catch((function(a){t().alerts.show({type:"error"},t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.load_error")),e.loading=!1,m.redraw()}))},r.processIncluded=function(e){e.included&&e.included.forEach((function(e){if("users"===e.type&&e.id&&!t().store.getById("users",e.id)){var a=t().store.createRecord("users");a.pushAttributes(e.attributes||{}),a.id(e.id)}}))},r.approveFeedback=function(e){var a=this;confirm(t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.confirm_approve"))&&t().request({method:"POST",url:t().forum.attribute("apiUrl")+"/trader/feedback/"+e.id+"/approve"}).then((function(){t().alerts.show({type:"success"},t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.approved_success")),a.loadPendingFeedbacks(),a.loadStats()})).catch((function(e){t().alerts.show({type:"error"},t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.approved_error"))}))},r.rejectFeedback=function(e){var a=this;confirm(t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.confirm_reject"))&&t().request({method:"POST",url:t().forum.attribute("apiUrl")+"/trader/feedback/"+e.id+"/reject"}).then((function(){t().alerts.show({type:"success"},t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.rejected_success")),a.loadPendingFeedbacks(),a.loadStats()})).catch((function(e){t().alerts.show({type:"error"},t().translator.trans("huseyinfiliz-traderfeedback.admin.approvals.rejected_error"))}))},r.dismissReport=function(e){var a=this;confirm(t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.confirm_dismiss"))&&t().request({method:"POST",url:t().forum.attribute("apiUrl")+"/trader/reports/"+e.id+"/dismiss"}).then((function(){t().alerts.show({type:"success"},t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.dismissed_success")),a.loadReports()})).catch((function(e){t().alerts.show({type:"error"},t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.dismissed_error"))}))},r.deleteReportedFeedback=function(e){var a=this;confirm(t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.confirm_delete"))&&t().request({method:"POST",url:t().forum.attribute("apiUrl")+"/trader/reports/"+e.id+"/reject"}).then((function(){t().alerts.show({type:"success"},t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.deleted_success")),a.loadReports(),a.loadStats()})).catch((function(e){t().alerts.show({type:"error"},t().translator.trans("huseyinfiliz-traderfeedback.admin.reports.deleted_error"))}))},a}(n());t().initializers.add("huseyinfiliz-traderfeedback",(function(){t().extensionData.for("huseyinfiliz-traderfeedback").registerPage(_).registerPermission({icon:"fas fa-comment",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.permissions.give_feedback"),permission:"huseyinfiliz-traderfeedback.give"},"reply",!0).registerPermission({icon:"fas fa-flag",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.permissions.report_feedback"),permission:"huseyinfiliz-traderfeedback.report"},"reply",!0).registerPermission({icon:"fas fa-trash",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.permissions.delete_feedback"),permission:"huseyinfiliz-traderfeedback.delete"},"moderate").registerPermission({icon:"fas fa-shield-alt",label:t().translator.trans("huseyinfiliz-traderfeedback.admin.permissions.moderate_feedback"),permission:"huseyinfiliz-traderfeedback.moderate"},"moderate")}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map