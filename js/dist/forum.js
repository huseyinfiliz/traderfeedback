(()=>{var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{extend:()=>O});const a=flarum.core.compat["forum/app"];var r=e.n(a);const s=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/UserPage"];var n=e.n(o);const i=flarum.core.compat["common/components/LinkButton"];var c=e.n(i);function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function l(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,d(e,t)}const u=flarum.core.compat["common/components/LoadingIndicator"];var f=e.n(u);const p=flarum.core.compat["common/components/Button"];var b=e.n(p);const h=flarum.core.compat["common/helpers/humanTime"];var k=e.n(h);const g=flarum.core.compat["common/components/Select"];var y=e.n(g);const v=flarum.core.compat["common/components/Placeholder"];var _=e.n(v);const F=flarum.core.compat["common/components/Modal"];var z=e.n(F);const N=flarum.core.compat["common/utils/Stream"];var w=e.n(N),T=function(e){function t(){return e.apply(this,arguments)||this}l(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.user=this.attrs.user,this.loading=!1,this.type=w()("positive"),this.role=w()("buyer"),this.comment=w()("")},a.className=function(){return"Modal Modal--medium"},a.title=function(){return r().translator.trans("huseyinfiliz-traderfeedback.forum.form.title",{username:this.user.displayName()})},a.content=function(){var e=this;return m(".Modal-body",[m(".Form",[m(".Form-group",[m("label",r().translator.trans("huseyinfiliz-traderfeedback.forum.form.type_label")),y().component({value:this.type(),options:{positive:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.type_positive"),neutral:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.type_neutral"),negative:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.type_negative")},onchange:this.type})]),m(".Form-group",[m("label",r().translator.trans("huseyinfiliz-traderfeedback.forum.form.role_label")),y().component({value:this.role(),options:{buyer:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.role_buyer"),seller:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.role_seller"),trader:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.role_trader")},onchange:this.role})]),m(".Form-group",[m("label",r().translator.trans("huseyinfiliz-traderfeedback.forum.form.comment_label")),m("textarea.FormControl",{value:this.comment(),oninput:function(t){return e.comment(t.target.value)},placeholder:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.comment_placeholder"),rows:5})]),m(".Form-group",[b().component({type:"submit",className:"Button Button--primary",loading:this.loading,disabled:!this.comment().trim()},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.submit_button"))])])])},a.onsubmit=function(e){var t=this;if(e.preventDefault(),this.comment().trim()){var a=r().forum.attribute("huseyinfiliz.traderfeedback.minLength")||10,s=r().forum.attribute("huseyinfiliz.traderfeedback.maxLength")||1e3;this.comment().length<a?r().alerts.show({type:"error"},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.error_too_short",{min:a})):this.comment().length>s?r().alerts.show({type:"error"},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.error_too_long",{max:s})):(this.loading=!0,m.redraw(),r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/trader/feedback",body:{data:{type:"feedbacks",attributes:{to_user_id:this.user.id(),type:this.type(),role:this.role(),comment:this.comment()}}}}).then((function(){r().alerts.show({type:"success"},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.success")),t.hide(),window.location.reload()})).catch((function(e){t.loading=!1,m.redraw(),e.response&&e.response.errors?r().alerts.show({type:"error"},e.response.errors[0].detail):r().alerts.show({type:"error"},"Error submitting feedback")})))}},t}(z()),x=function(e){function t(){for(var t,a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(t=e.call.apply(e,[this].concat(r))||this).feedbacks=[],t.stats=null,t.loading=!1,t.statsLoading=!1,t.filter="all",t}l(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.loading=!0,this.statsLoading=!0,this.loadUser(this.attrs.username)},a.oncreate=function(t){e.prototype.oncreate.call(this,t),this.loadFeedbacks(),this.loadStats()},a.loadFeedbacks=function(){var e=this;this.loading=!0,r().request({method:"GET",url:r().forum.attribute("apiUrl")+"/trader/feedback",params:{filter:{user:this.user.id(),type:"all"===this.filter?null:this.filter}}}).then((function(t){e.feedbacks=Array.isArray(t)?t:t.data||[],e.loading=!1,m.redraw()})).catch((function(t){e.feedbacks=[],e.loading=!1,m.redraw()}))},a.loadStats=function(){var e=this;this.statsLoading=!0,r().request({method:"GET",url:r().forum.attribute("apiUrl")+"/trader/stats/"+this.user.id()}).then((function(t){if(t&&t.data){var a=t.data.attributes||t.data;e.stats={score:a.score||0,positive_count:a.positive_count||0,neutral_count:a.neutral_count||0,negative_count:a.negative_count||0}}else e.stats={score:0,positive_count:0,neutral_count:0,negative_count:0};e.statsLoading=!1,m.redraw()})).catch((function(t){e.stats={score:0,positive_count:0,neutral_count:0,negative_count:0},e.statsLoading=!1,m.redraw()}))},a.content=function(){return this.loading||!this.user?m("div",{className:"TraderFeedbackPage"},m(f(),null)):m("div",{className:"TraderFeedbackPage"},m("div",{className:"TraderFeedbackPage-header"},m("h2",null,r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.title",{username:this.user.displayName()})),this.statsSection()),this.filterSection(),this.feedbacksList())},a.statsSection=function(){if(this.statsLoading)return m("div",{className:"TraderFeedbackPage-stats"},m(f(),{size:"small"}));if(!this.stats)return null;var e=this.stats.positive_count+this.stats.neutral_count+this.stats.negative_count>0?Math.round(this.stats.score):0;return m("div",{className:"TraderFeedbackPage-stats"},m("div",{className:"TraderFeedbackPage-stat score"},m("div",{className:"TraderFeedbackPage-stat-value"},e,"%"),m("div",{className:"TraderFeedbackPage-stat-label"},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.stats.score"))),m("div",{className:"TraderFeedbackPage-stat positive"},m("div",{className:"TraderFeedbackPage-stat-value"},this.stats.positive_count),m("div",{className:"TraderFeedbackPage-stat-label"},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.stats.positive"))),m("div",{className:"TraderFeedbackPage-stat neutral"},m("div",{className:"TraderFeedbackPage-stat-value"},this.stats.neutral_count),m("div",{className:"TraderFeedbackPage-stat-label"},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.stats.neutral"))),m("div",{className:"TraderFeedbackPage-stat negative"},m("div",{className:"TraderFeedbackPage-stat-value"},this.stats.negative_count),m("div",{className:"TraderFeedbackPage-stat-label"},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.stats.negative"))))},a.filterSection=function(){var e=this;return m("div",{className:"TraderFeedbackPage-filters"},m(y(),{value:this.filter,options:{all:r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.filter.all"),positive:r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.filter.positive"),neutral:r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.filter.neutral"),negative:r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.filter.negative")},onchange:function(t){e.filter=t,e.loadFeedbacks()}}),r().session.user&&r().session.user.id()!==this.user.id()&&m(b(),{className:"Button Button--primary",onclick:function(){r().modal.show(T,{user:e.user})}},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.give_feedback_button")))},a.feedbacksList=function(){var e=this;return this.feedbacks&&Array.isArray(this.feedbacks)&&0!==this.feedbacks.length?m("div",{className:"TraderFeedbackPage-list"},this.feedbacks.map((function(t){return e.feedbackItem(t)}))):m(_(),{text:r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.no_feedback")})},a.feedbackItem=function(e){var t,a,s=null==(t=(e.relationships||{}).fromUser)?void 0:t.data,o=e.attributes||{},n=null,i="Unknown User",c="#888";s&&(n=r().store.getById("users",s.id)),!n&&o.from_user_id&&(n=r().store.getById("users",String(o.from_user_id))),n?(i=n.displayName(),c=n.color()||"#888"):o.from_user_id&&(i="User #"+o.from_user_id);var d=o.created_at||(new Date).toISOString();return m("div",{className:"FeedbackItem feedback-"+o.type,key:e.id},m("div",{className:"FeedbackItem-header"},m("div",{className:"FeedbackItem-user"},m("span",{className:"Avatar",style:{background:c,width:"32px",height:"32px",borderRadius:"50%",display:"inline-flex",alignItems:"center",justifyContent:"center",marginRight:"8px",color:"white",fontSize:"14px",fontWeight:"bold"}},(null==(a=i[0])?void 0:a.toUpperCase())||"?"),m("span",{className:"username"},i)),m("div",{className:"FeedbackItem-date"},k()(d))),m("div",{className:"FeedbackItem-meta"},m("span",{className:"FeedbackItem-type feedback-type-"+o.type,style:{padding:"2px 8px",borderRadius:"4px",fontSize:"0.9em",background:"positive"===o.type?"#4CAF5020":"negative"===o.type?"#f4433620":"#FF980020",color:"positive"===o.type?"#2E7D32":"negative"===o.type?"#C62828":"#E65100"}},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.type_"+o.type)),m("span",{className:"FeedbackItem-role",style:{marginLeft:"8px",padding:"2px 8px",borderRadius:"4px",fontSize:"0.9em",background:"rgba(0,0,0,0.1)"}},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_item.as_"+o.role))),m("div",{className:"FeedbackItem-comment",style:{marginTop:"10px",padding:"10px",background:"rgba(0,0,0,0.02)",borderRadius:"4px"}},o.comment||"No comment provided"),this.feedbackActions(e,n))},a.feedbackActions=function(e,t){var a=this,s=r().session.user;if(!s)return null;var o=s.attribute("canModerateFeedback"),n=t&&s.id()===t.id();return m("div",{className:"FeedbackItem-actions",style:{marginTop:"10px",paddingTop:"10px",borderTop:"1px solid rgba(0,0,0,0.1)"}},!n&&m(b(),{className:"Button Button--link",onclick:function(){return a.reportFeedback(e)}},m("i",{className:"fas fa-flag",style:{marginRight:"5px"}}),r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_item.report_button")),(n||o)&&m(b(),{className:"Button Button--link Button--danger",onclick:function(){return a.deleteFeedback(e)}},m("i",{className:"fas fa-trash",style:{marginRight:"5px"}}),r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_item.delete_button")))},a.reportFeedback=function(e){var t=this,a=prompt("Please provide a reason for reporting this feedback:");a&&a.trim()&&(this.loading=!0,m.redraw(),r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/trader/feedback/"+e.id+"/report",body:{data:{attributes:{reason:a.trim()}}}}).then((function(){t.loading=!1,r().alerts.show({type:"success"},r().translator.trans("huseyinfiliz-traderfeedback.forum.report_modal.success")),m.redraw()})).catch((function(e){t.loading=!1,r().alerts.show({type:"error"},"Failed to report feedback"),m.redraw()})))},a.deleteFeedback=function(e){var t=this;confirm(r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_item.confirm_delete"))&&(this.loading=!0,m.redraw(),r().request({method:"DELETE",url:r().forum.attribute("apiUrl")+"/trader/feedback/"+e.id}).then((function(){t.loading=!1,t.feedbacks=t.feedbacks.filter((function(t){return t.id!==e.id})),t.loadStats(),r().alerts.show({type:"success"},"Feedback deleted successfully"),m.redraw()})).catch((function(e){t.loading=!1,r().alerts.show({type:"error"},"Failed to delete feedback"),m.redraw()})))},t}(n());const P=flarum.core.compat["forum/utils/UserControls"];var S=e.n(P);const I=flarum.core.compat["common/extenders"];var L=e.n(I);const U=flarum.core.compat["common/models/Forum"];var B=e.n(U);const O=[new(L().Model)(B()).attribute("huseyinfilizTraderAdmin").attribute("huseyinfilizTraderUser")];r().initializers.add("huseyinfiliz-traderfeedback",(function(){r().feedbackModal=T,r().routes["user.feedbacks"]={path:"/u/:username/feedbacks",component:x},(0,s.extend)(n().prototype,"navItems",(function(e){var t;e.add("traderFeedbacksLink",m(c(),{href:r().route("user.feedbacks",{username:null==(t=this.user)?void 0:t.slug()}),name:"feedbacks",icon:"fas fa-exchange-alt"},r().translator.trans("huseyinfiliz-traderfeedback.forum.nav.feedback_link")),79)})),(0,s.extend)(S(),"userControls",(function(e,t){r().session.user&&r().session.user.id()!==t.id()&&e.add("giveFeedback",b().component({icon:"fas fa-exchange-alt",onclick:function(){r().modal.show(T,{user:t})}},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.submit_button")),100)}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map