(()=>{var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{extend:()=>G});const a=flarum.core.compat["forum/app"];var r=e.n(a);const s=flarum.core.compat["common/extend"],i=flarum.core.compat["forum/components/UserPage"];var n=e.n(i);const o=flarum.core.compat["common/components/LinkButton"];var c=e.n(o);const d=flarum.core.compat["forum/components/NotificationGrid"];var u=e.n(d);function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function f(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,l(e,t)}const p=flarum.core.compat["common/components/LoadingIndicator"];var b=e.n(p);const h=flarum.core.compat["common/components/Button"];var k=e.n(h);const y=flarum.core.compat["common/helpers/humanTime"];var v=e.n(y);const g=flarum.core.compat["common/components/Select"];var _=e.n(g);const z=flarum.core.compat["common/components/Placeholder"];var F=e.n(z);const N=flarum.core.compat["common/components/Modal"];var w=e.n(N);const x=flarum.core.compat["common/utils/Stream"];var I=e.n(x),T=function(e){function t(){return e.apply(this,arguments)||this}f(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.user=this.attrs.user,this.loading=!1,this.type=I()("positive"),this.role=I()("buyer"),this.comment=I()(""),this.discussionInput=I()(""),this.discussionId=null},a.className=function(){return"Modal Modal--medium"},a.title=function(){return r().translator.trans("huseyinfiliz-traderfeedback.forum.form.title",{username:this.user.displayName()})},a.content=function(){var e=this,t=r().forum.attribute("huseyinfiliz.traderfeedback.requireDiscussion")||!1,a=!1!==r().forum.attribute("huseyinfiliz.traderfeedback.allowNegative"),s={positive:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.type_positive"),neutral:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.type_neutral")};return a&&(s.negative=r().translator.trans("huseyinfiliz-traderfeedback.forum.form.type_negative")),m(".Modal-body",[m(".Form",[m(".Form-group",[m("label",r().translator.trans("huseyinfiliz-traderfeedback.forum.form.type_label")),_().component({value:this.type(),options:s,onchange:this.type})]),m(".Form-group",[m("label",r().translator.trans("huseyinfiliz-traderfeedback.forum.form.role_label")),_().component({value:this.role(),options:{buyer:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.role_buyer"),seller:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.role_seller"),trader:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.role_trader")},onchange:this.role})]),m(".Form-group",[m("label",[r().translator.trans("huseyinfiliz-traderfeedback.forum.form.discussion_label"),t&&m("span.required"," *")]),m("input.FormControl",{value:this.discussionInput(),oninput:function(t){e.discussionInput(t.target.value),e.parseDiscussionId(t.target.value)},placeholder:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.discussion_placeholder"),required:t}),m(".helpText",r().translator.trans("huseyinfiliz-traderfeedback.forum.form.discussion_help"))]),m(".Form-group",[m("label",r().translator.trans("huseyinfiliz-traderfeedback.forum.form.comment_label")),m("textarea.FormControl",{value:this.comment(),oninput:function(t){return e.comment(t.target.value)},placeholder:r().translator.trans("huseyinfiliz-traderfeedback.forum.form.comment_placeholder"),rows:5})]),m(".Form-group",[k().component({type:"submit",className:"Button Button--primary",loading:this.loading,disabled:!this.comment().trim()||t&&!this.discussionId},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.submit_button"))])])])},a.parseDiscussionId=function(e){if(e){var t=e.match(/\/d\/(\d+)(?:-[^\/]+)?/);if(t)this.discussionId=parseInt(t[1]);else{var a=e.match(/^\d+$/);this.discussionId=a?parseInt(e):null}}else this.discussionId=null},a.onsubmit=function(e){var t=this;if(e.preventDefault(),this.comment().trim())if(!r().forum.attribute("huseyinfiliz.traderfeedback.requireDiscussion")||this.discussionId){var a=r().forum.attribute("huseyinfiliz.traderfeedback.minLength")||10,s=r().forum.attribute("huseyinfiliz.traderfeedback.maxLength")||1e3;if(this.comment().length<a)r().alerts.show({type:"error"},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.error_too_short",{min:a}));else if(this.comment().length>s)r().alerts.show({type:"error"},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.error_too_long",{max:s}));else if(!1!==r().forum.attribute("huseyinfiliz.traderfeedback.allowNegative")||"negative"!==this.type()){this.loading=!0,m.redraw();var i={to_user_id:this.user.id(),type:this.type(),role:this.role(),comment:this.comment()};this.discussionId&&(i.discussion_id=this.discussionId),r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/trader/feedback",body:{data:{type:"feedbacks",attributes:i}}}).then((function(){r().alerts.show({type:"success"},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.success")),t.hide(),window.location.reload()})).catch((function(e){t.loading=!1,m.redraw(),e.response&&e.response.errors?r().alerts.show({type:"error"},e.response.errors[0].detail):r().alerts.show({type:"error"},"Error submitting feedback")}))}else r().alerts.show({type:"error"},"Negative feedback is not allowed.")}else r().alerts.show({type:"error"},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.error_discussion_required"))},t}(w()),U=function(e){function t(){for(var t,a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(t=e.call.apply(e,[this].concat(r))||this).feedbacks=[],t.stats=null,t.loading=!1,t.statsLoading=!1,t.filter="all",t.includedUsers=new Map,t}f(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.loading=!0,this.statsLoading=!0,this.loadUser(this.attrs.username)},a.oncreate=function(t){e.prototype.oncreate.call(this,t),this.loadFeedbacks(),this.loadStats()},a.loadFeedbacks=function(){var e=this;this.loading=!0,r().request({method:"GET",url:r().forum.attribute("apiUrl")+"/trader/feedback",params:{filter:{user:this.user.id(),type:"all"===this.filter?null:this.filter}}}).then((function(t){t.included&&t.included.forEach((function(t){if("users"===t.type){e.includedUsers.set(t.id,t.attributes);var a=r().store.getById("users",t.id);a?a.pushData(t.attributes):r().store.pushPayload({data:t})}})),e.feedbacks=Array.isArray(t.data)?t.data:[],e.loading=!1,m.redraw()})).catch((function(t){e.feedbacks=[],e.loading=!1,m.redraw()}))},a.loadStats=function(){var e=this;this.statsLoading=!0,r().request({method:"GET",url:r().forum.attribute("apiUrl")+"/trader/stats/"+this.user.id()}).then((function(t){if(t&&t.data){var a=t.data.attributes||t.data;e.stats={score:a.score||0,positive_count:a.positive_count||0,neutral_count:a.neutral_count||0,negative_count:a.negative_count||0}}else e.stats={score:0,positive_count:0,neutral_count:0,negative_count:0};e.statsLoading=!1,m.redraw()})).catch((function(t){e.stats={score:0,positive_count:0,neutral_count:0,negative_count:0},e.statsLoading=!1,m.redraw()}))},a.content=function(){return this.loading||!this.user?m("div",{className:"TraderFeedbackPage"},m(b(),null)):m("div",{className:"TraderFeedbackPage"},m("div",{className:"TraderFeedbackPage-header"},this.statsSection()),this.filterSection(),this.feedbacksList())},a.statsSection=function(){if(this.statsLoading)return m("div",{className:"TraderFeedbackPage-stats"},m(b(),{size:"small"}));if(!this.stats)return null;var e=this.stats.positive_count+this.stats.neutral_count+this.stats.negative_count>0?Math.round(this.stats.score):0;return m("div",{className:"TraderFeedbackPage-stats"},m("div",{className:"TraderFeedbackPage-stat score"},m("div",{className:"TraderFeedbackPage-stat-value"},e,"%"),m("div",{className:"TraderFeedbackPage-stat-label"},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.stats.score"))),m("div",{className:"TraderFeedbackPage-stat positive"},m("div",{className:"TraderFeedbackPage-stat-value"},this.stats.positive_count),m("div",{className:"TraderFeedbackPage-stat-label"},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.stats.positive"))),m("div",{className:"TraderFeedbackPage-stat neutral"},m("div",{className:"TraderFeedbackPage-stat-value"},this.stats.neutral_count),m("div",{className:"TraderFeedbackPage-stat-label"},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.stats.neutral"))),m("div",{className:"TraderFeedbackPage-stat negative"},m("div",{className:"TraderFeedbackPage-stat-value"},this.stats.negative_count),m("div",{className:"TraderFeedbackPage-stat-label"},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.stats.negative"))))},a.filterSection=function(){var e=this,t=!1!==r().forum.attribute("huseyinfiliz.traderfeedback.allowNegative"),a={all:r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.filter.all"),positive:r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.filter.positive"),neutral:r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.filter.neutral")};return t&&(a.negative=r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.filter.negative")),m("div",{className:"TraderFeedbackPage-filters"},m(_(),{value:this.filter,options:a,onchange:function(t){e.filter=t,e.loadFeedbacks()}}),r().session.user&&r().session.user.id()!==this.user.id()&&m(k(),{className:"Button Button--primary",onclick:function(){r().modal.show(T,{user:e.user})}},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.give_feedback_button")))},a.feedbacksList=function(){var e=this;return this.feedbacks&&Array.isArray(this.feedbacks)&&0!==this.feedbacks.length?m("div",{className:"TraderFeedbackPage-list"},this.feedbacks.map((function(t){return e.feedbackItem(t)}))):m(F(),{text:r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_page.no_feedback")})},a.feedbackItem=function(e){var t,a,s=e.attributes||{},i=null,n="Unknown User",o="#888",c=null,d=null==(t=e.relationships)||null==(t=t.fromUser)?void 0:t.data;if(d){var u=d.id,l=this.includedUsers.get(u);l?(n=l.displayName||l.username||"User #"+u,c=l.avatarUrl,(i=r().store.getById("users",u))&&(o=i.color()||"#888")):(i=r().store.getById("users",u))&&(n=i.displayName(),o=i.color()||"#888",c=i.avatarUrl())}if((!n||"Unknown User"===n)&&(s.fromUserId||s.from_user_id)){var f=s.fromUserId||s.from_user_id,p=this.includedUsers.get(String(f));p?(n=p.displayName||p.username||"User #"+f,c=p.avatarUrl):(i=r().store.getById("users",String(f)))?(n=i.displayName(),o=i.color()||"#888",c=i.avatarUrl()):n="User #"+f}var b=s.createdAt||s.created_at||(new Date).toISOString(),h=s.discussionId||s.discussion_id?m("a",{href:r().route("discussion",{id:s.discussionId||s.discussion_id}),className:"FeedbackItem-discussionLink",target:"_blank"},m("i",{className:"fas fa-external-link-alt"}),r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_item.discussion_link")):null;return m("div",{className:"FeedbackItem feedback-"+s.type,key:e.id},m("div",{className:"FeedbackItem-header"},m("div",{className:"FeedbackItem-user"},c?m("img",{className:"Avatar",src:c,alt:n,style:{width:"32px",height:"32px",borderRadius:"50%",marginRight:"8px"}}):m("span",{className:"Avatar",style:{background:o,width:"32px",height:"32px",borderRadius:"50%",display:"inline-flex",alignItems:"center",justifyContent:"center",marginRight:"8px",color:"white",fontSize:"14px",fontWeight:"bold"}},(null==(a=n[0])?void 0:a.toUpperCase())||"?"),m("span",{className:"username"},n)),m("div",{className:"FeedbackItem-date"},v()(b),h)),m("div",{className:"FeedbackItem-meta"},m("span",{className:"FeedbackItem-type feedback-type-"+s.type,style:{padding:"2px 8px",borderRadius:"4px",fontSize:"0.9em",background:"positive"===s.type?"#4CAF5020":"negative"===s.type?"#f4433620":"#FF980020",color:"positive"===s.type?"#2E7D32":"negative"===s.type?"#C62828":"#E65100"}},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.type_"+s.type)),m("span",{className:"FeedbackItem-role",style:{marginLeft:"8px",padding:"2px 8px",borderRadius:"4px",fontSize:"0.9em",background:"rgba(0,0,0,0.1)"}},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_item.as_"+s.role))),m("div",{className:"FeedbackItem-comment",style:{marginTop:"10px",padding:"10px",background:"rgba(0,0,0,0.02)",borderRadius:"4px"}},s.comment||"No comment provided"),this.feedbackActions(e,i))},a.feedbackActions=function(e,t){var a=this,s=r().session.user;if(!s)return null;var i=e.attributes||{},n=!1!==i.canReport&&!1!==s.attribute("canReportFeedback"),o=i.canDelete||s.attribute("canDeleteFeedback"),c=s.attribute("canModerateFeedback"),d=t&&s.id()===t.id();return n||o||d||c?m("div",{className:"FeedbackItem-actions",style:{marginTop:"10px",paddingTop:"10px",borderTop:"1px solid rgba(0,0,0,0.1)"}},!d&&n&&m(k(),{className:"Button Button--link",onclick:function(){return a.reportFeedback(e)},title:r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_item.report_button")},m("i",{className:"fas fa-flag",style:{marginRight:"5px"}}),r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_item.report_button")),(d||o||c)&&m(k(),{className:"Button Button--link Button--danger",onclick:function(){return a.deleteFeedback(e)},title:r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_item.delete_button")},m("i",{className:"fas fa-trash",style:{marginRight:"5px"}}),r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_item.delete_button")),!n&&!d&&!o&&!c&&m("span",{className:"text-muted",style:{fontSize:"0.9em",fontStyle:"italic"}},r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_item.no_permission_report"))):null},a.reportFeedback=function(e){var t=this,a=prompt("Please provide a reason for reporting this feedback:");a&&a.trim()&&(this.loading=!0,m.redraw(),r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/trader/feedback/"+e.id+"/report",body:{data:{attributes:{reason:a.trim()}}}}).then((function(){t.loading=!1,r().alerts.show({type:"success"},r().translator.trans("huseyinfiliz-traderfeedback.forum.report_modal.success")),m.redraw()})).catch((function(e){t.loading=!1,r().alerts.show({type:"error"},"Failed to report feedback"),m.redraw()})))},a.deleteFeedback=function(e){var t=this;confirm(r().translator.trans("huseyinfiliz-traderfeedback.forum.feedback_item.confirm_delete"))&&(this.loading=!0,m.redraw(),r().request({method:"DELETE",url:r().forum.attribute("apiUrl")+"/trader/feedback/"+e.id}).then((function(){t.loading=!1,t.feedbacks=t.feedbacks.filter((function(t){return t.id!==e.id})),t.loadStats(),r().alerts.show({type:"success"},"Feedback deleted successfully"),m.redraw()})).catch((function(e){t.loading=!1,r().alerts.show({type:"error"},"Failed to delete feedback"),m.redraw()})))},t}(n());const P=flarum.core.compat["forum/utils/UserControls"];var S=e.n(P);const j=flarum.core.compat["forum/components/Notification"];var L=e.n(j);const A=flarum.core.compat["common/helpers/username"];var B=e.n(A),R=function(e){function t(){return e.apply(this,arguments)||this}f(t,e);var a=t.prototype;return a.icon=function(){return"fas fa-check-circle"},a.href=function(){var e,t=this.attrs.notification;if(!t.subject())return app.route("index");var a=t.fromUser();return a?app.route("user.feedbacks",{username:a.slug()}):app.route("user.feedbacks",{username:null==(e=app.session.user)?void 0:e.slug()})},a.content=function(){var e=this.attrs.notification.fromUser();return app.translator.trans("huseyinfiliz-traderfeedback.forum.notifications.feedback_approved_title",{username:e?B()(e):"Someone"})},a.excerpt=function(){var e=this.attrs.notification.subject();return e&&e.comment?e.comment():""},t}(L()),O=function(e){function t(){return e.apply(this,arguments)||this}f(t,e);var a=t.prototype;return a.icon=function(){return"fas fa-times-circle"},a.href=function(){var e,t=this.attrs.notification;if(!t.subject())return app.route("index");var a=t.fromUser();return a?app.route("user.feedbacks",{username:a.slug()}):app.route("user.feedbacks",{username:null==(e=app.session.user)?void 0:e.slug()})},a.content=function(){var e=this.attrs.notification.fromUser();return app.translator.trans("huseyinfiliz-traderfeedback.forum.notifications.feedback_rejected_title",{username:e?B()(e):"Someone"})},a.excerpt=function(){var e=this.attrs.notification.subject();return e&&e.comment?e.comment():""},t}(L()),C=function(e){function t(){return e.apply(this,arguments)||this}f(t,e);var a=t.prototype;return a.icon=function(){var e=this.attrs.notification.subject();if(e&&e.type){var t=e.type();if("positive"===t)return"fas fa-thumbs-up";if("negative"===t)return"fas fa-thumbs-down"}return"fas fa-exchange-alt"},a.href=function(){var e=this.attrs.notification.fromUser();return e?app.route("user.feedbacks",{username:e.slug()}):app.route("index")},a.content=function(){var e=this.attrs.notification,t=e.fromUser(),a=e.subject(),r="neutral",s="buyer";a&&(a.type&&(r=a.type()),a.role&&(s=a.role()));var i="seller"===s?app.translator.trans("huseyinfiliz-traderfeedback.forum.form.role_seller"):app.translator.trans("huseyinfiliz-traderfeedback.forum.form.role_buyer"),n=app.translator.trans("huseyinfiliz-traderfeedback.forum.form.type_"+r);return app.translator.trans("huseyinfiliz-traderfeedback.forum.notifications.new_feedback_title",{username:t?B()(t):"Someone",type:n,role:i})},a.excerpt=function(){var e=this.attrs.notification.subject();return e&&e.comment?e.comment():""},t}(L());const M=flarum.core.compat["common/extenders"];var D=e.n(M);const q=flarum.core.compat["common/models/Forum"];var E=e.n(q);const G=[new(D().Model)(E()).attribute("huseyinfilizTraderAdmin").attribute("huseyinfilizTraderUser")];r().initializers.add("huseyinfiliz-traderfeedback",(function(){r().feedbackModal=T,r().notificationComponents.feedbackApproved=R,r().notificationComponents.feedbackRejected=O,r().notificationComponents.newFeedback=C,console.log("✅ Trader feedback notification components registered"),r().routes["user.feedbacks"]={path:"/u/:username/feedbacks",component:U},(0,s.extend)(n().prototype,"navItems",(function(e){var t;e.add("traderFeedbacksLink",m(c(),{href:r().route("user.feedbacks",{username:null==(t=this.user)?void 0:t.slug()}),name:"feedbacks",icon:"fas fa-exchange-alt"},r().translator.trans("huseyinfiliz-traderfeedback.forum.nav.feedback_link")),79)})),(0,s.extend)(u().prototype,"notificationTypes",(function(e){e.add("newFeedback",{name:"newFeedback",icon:"fas fa-exchange-alt",label:r().translator.trans("huseyinfiliz-traderfeedback.forum.settings.notify_new_feedback_label")}),e.add("feedbackApproved",{name:"feedbackApproved",icon:"fas fa-check-circle",label:r().translator.trans("huseyinfiliz-traderfeedback.forum.settings.notify_feedback_approved_label")}),e.add("feedbackRejected",{name:"feedbackRejected",icon:"fas fa-times-circle",label:r().translator.trans("huseyinfiliz-traderfeedback.forum.settings.notify_feedback_rejected_label")})})),(0,s.extend)(S(),"userControls",(function(e,t){r().session.user&&r().session.user.id()!==t.id()&&e.add("giveFeedback",k().component({icon:"fas fa-exchange-alt",onclick:function(){r().modal.show(T,{user:t})}},r().translator.trans("huseyinfiliz-traderfeedback.forum.form.submit_button")),100)})),console.log("✅ Trader feedback extension initialized"),console.log("Registered notification components:",Object.keys(r().notificationComponents))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map